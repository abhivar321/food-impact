<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI Food Intake Estimator</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f7f9fb;
    }
    .custom-scroll::-webkit-scrollbar { width: 6px; }
    .custom-scroll::-webkit-scrollbar-thumb {
      background-color: #cbd5e1;
      border-radius: 3px;
    }
  </style>
</head>

<body class="min-h-screen flex items-center justify-center p-4">

<div class="w-full max-w-4xl bg-white shadow-2xl rounded-xl p-6 md:p-10">
  <h1 class="text-3xl font-bold text-center mb-2">
    AI Food Intake Estimator ðŸ¥—
  </h1>
  <p class="text-center text-gray-500 mb-6">
    Upload a food photo to estimate nutrition (AI-generated, not medical advice).
  </p>

  <div class="grid md:grid-cols-2 gap-8">
    <!-- Upload -->
    <div class="bg-gray-50 p-6 rounded-lg border-2 border-dashed">
      <input id="imageUpload" type="file" accept="image/*" hidden />
      <div id="imageBox"
           class="h-64 border rounded flex items-center justify-center bg-white cursor-pointer">
        <span id="placeholder" class="text-gray-400">Click to upload image</span>
        <img id="preview" class="hidden w-full h-full object-cover"/>
      </div>

      <button id="analyzeBtn"
        class="w-full mt-6 py-3 bg-indigo-600 text-white rounded-lg disabled:bg-indigo-400"
        disabled>
        Analyze Food
      </button>
    </div>

    <!-- Results -->
    <div class="p-6 border rounded">
      <div id="loading" class="hidden text-center text-indigo-600">
        <p class="animate-pulse">Analyzing imageâ€¦</p>
      </div>

      <div id="results" class="hidden custom-scroll max-h-96">
        <p class="font-semibold">Food: <span id="food"></span></p>
        <p class="text-sm mb-3">Serving: <span id="serving"></span></p>

        <div class="grid grid-cols-4 gap-2 mb-4">
          <div><b id="calories"></b> kcal</div>
          <div><b id="protein"></b> g protein</div>
          <div><b id="fat"></b> g fat</div>
          <div><b id="carbs"></b> g carbs</div>
        </div>

        <p class="text-sm bg-gray-100 p-3 rounded mb-3" id="impact"></p>

        <p class="text-green-700 text-sm mb-2" id="min"></p>
        <p class="text-red-700 text-sm" id="sig"></p>
      </div>

      <div id="error"
           class="hidden bg-red-100 text-red-700 p-4 rounded">
      </div>
    </div>
  </div>
</div>

<script>
/* ===================== CONFIG ===================== */

const API_KEY = "YOUR_GEMINI_API_KEY_HERE";
const MODEL = "gemini-1.5-flash";

/* ===================== DOM ===================== */

const upload = document.getElementById('imageUpload');
const box = document.getElementById('imageBox');
const preview = document.getElementById('preview');
const placeholder = document.getElementById('placeholder');
const btn = document.getElementById('analyzeBtn');
const loading = document.getElementById('loading');
const results = document.getElementById('results');
const errorBox = document.getElementById('error');

let base64 = null;
let mimeType = "image/jpeg";

/* ===================== UPLOAD ===================== */

box.onclick = () => upload.click();

upload.onchange = () => {
  const file = upload.files[0];
  if (!file) return;

  mimeType = file.type || "image/jpeg";
  const reader = new FileReader();
  reader.onload = e => {
    preview.src = e.target.result;
    preview.classList.remove("hidden");
    placeholder.classList.add("hidden");
    base64 = e.target.result.split(",")[1];
    btn.disabled = false;
  };
  reader.readAsDataURL(file);
};

/* ===================== ANALYSIS ===================== */

btn.onclick = async () => {
  if (!base64) return;

  btn.disabled = true;
  loading.classList.remove("hidden");
  results.classList.add("hidden");
  errorBox.classList.add("hidden");

  try {
    const res = await fetch(
      `https://generativelanguage.googleapis.com/v1beta/models/${MODEL}:generateContent?key=${API_KEY}`,
      {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          systemInstruction: {
            parts: [{ text:
              "You are a food image nutrition estimator. Give approximate values only."
            }]
          },
          contents: [{
            role: "user",
            parts: [
              { text: "Analyze this food and respond in JSON." },
              { inlineData: { mimeType, data: base64 }}
            ]
          }],
          generationConfig: {
            responseMimeType: "application/json",
            responseSchema: {
              type: "OBJECT",
              properties: {
                foodDescription: { type: "STRING" },
                estimatedServingSizeGrams: { type: "NUMBER" },
                caloriesKcal: { type: "NUMBER" },
                proteinGrams: { type: "NUMBER" },
                fatGrams: { type: "NUMBER" },
                carbsGrams: { type: "NUMBER" },
                dailyImpactSummary: { type: "STRING" },
                suggestionMinimalImpact: { type: "STRING" },
                suggestionSignificantImpact: { type: "STRING" }
              }
            }
          }
        })
      }
    );

    const json = await res.json();
    console.log("Gemini raw response:", json);

    if (!json.candidates?.length) {
      throw new Error("No candidates returned");
    }

    const text = json.candidates[0].content.parts[0].text;
    const data = JSON.parse(text.replace(/```json|```/g,""));

    document.getElementById('food').textContent = data.foodDescription ?? "Unknown";
    document.getElementById('serving').textContent =
      (data.estimatedServingSizeGrams ?? "?") + " g";

    document.getElementById('calories').textContent = data.caloriesKcal ?? "?";
    document.getElementById('protein').textContent = data.proteinGrams ?? "?";
    document.getElementById('fat').textContent = data.fatGrams ?? "?";
    document.getElementById('carbs').textContent = data.carbsGrams ?? "?";

    document.getElementById('impact').textContent =
      data.dailyImpactSummary ?? "";

    document.getElementById('min').textContent =
      data.suggestionMinimalImpact ?? "";

    document.getElementById('sig').textContent =
      data.suggestionSignificantImpact ?? "";

    results.classList.remove("hidden");

  } catch (err) {
    console.error(err);
    errorBox.textContent =
      "Analysis failed. Check API key, billing, or open DevTools for details.";
    errorBox.classList.remove("hidden");
  }

  loading.classList.add("hidden");
  btn.disabled = false;
};
</script>

</body>
</html>
